## 快速开始

### 环境要求
- **Python**: 3.12+
- **uv**: 快速的 Python 包管理器

安装 uv（macOS）：
```bash
brew install uv
```

### 安装依赖
```bash
uv venv
uv sync
```

### 配置环境变量
在项目根目录创建 `.env` 文件：
```bash
OPENAI_API_KEY=your_api_key
OPENAI_API_BASE=https://api.openai.com/v1
OPENAI_MODEL_ID=gpt-4o-mini
```

### 运行分类
- 输入：默认读取 `test2.csv`（需要包含 `bmh, ocr, cleaned_ocr, cluster` 等列）
- 输出：`test2_classified.csv`

命令：
```bash
uv run python topic_classification.py
```

### 运行统计分析
- 默认输入：`test2_classified.csv`
- 默认输出：`classified_stats.csv`

使用默认参数：
```bash
uv run python analyze.py
```

自定义输入/输出路径：
```bash
uv run python analyze.py --input data/test2_classified.csv --output data/classified_stats.csv
```

### 说明
- 分析阶段会忽略“其他/其它/other/others”等一级标签。
- “关键词 (二级标签)”为该一级下所有二级标签（按频次降序，用“、”连接）。


### 挖掘初始类别体系（利用大模型）
- **目标**: 从样本数据中自动“挖掘/归纳”一套适用的一、二级类别体系，并作为分类 Prompt 的起点。
- **建议流程**:
  - **随机抽样**: 从原始数据（如 `ocr` 字段）随机抽取 200–500 条短文本。任何能保证随机性的方式均可（如在表格工具中随机、或用一段 Python 采样代码）。
  - **分批组织**: 将样本分成多批（每批 50–100 条），以便模型更稳定地输出结构化结果。
  - **让大模型归纳**: 使用 GPT、Claude、Gemini 等模型，给出“请提出一套一、二级类别并示例”的指令，注意控制温度（如 ≤ 0.3）以提升一致性。
  - **合并与去重**: 将多批次的结果进行合并、合并近义标签、删除冗余，得到一版初始“一级/二级”类别清单。

- **示例提示词模板（可直接给模型）**：
```text
请阅读以下若干条教育评价短文本，归纳出一套“一级/二级”类别体系，用于后续自动分类。

要求：
1) 先给出 5–12 个“一级类别”，每个一级类别下列出 3–10 个常见“二级观点/关键词”。
2) 二级建议使用短语或短句，尽量不超过 12 个字。
3) 只基于给定文本归纳，宁缺毋滥；相似项可合并。
4) 最终仅输出 JSON，形如：
{
  "一级类别A": ["二级a1", "二级a2", ...],
  "一级类别B": ["二级b1", "二级b2", ...]
}

待归纳的文本（用 \n 分隔）：
<sample_text_block>
```

- **将挖掘结果接入工程**:
  - 打开 `topic_classification.py` 中的 `seed_prompt`，把你最终确定的“一级/二级”类别清单替换到提示词的类别部分（保持“输出格式及要求”部分不变）。
  - 建议保留一个“其他”兜底类；统计阶段会自动忽略“其他/其它/other/others”一级标签。


### 手动维护类别（增删改）
- **修改入口**: 统一在 `topic_classification.py` 的 `seed_prompt` 中维护类别清单与示例。
- **增加一级类别**:
  - 在 `seed_prompt` 的类别列表中新增一个编号段，名称简洁明确；
  - 在该一级下补充若干典型二级观点/关键词示例；
  - 保持提示末尾的“输出 JSON 格式”与示例不变。
- **删除一级类别**:
  - 直接从 `seed_prompt` 中移除对应编号段；
  - 历史已生成的 `*.csv` 不会被自动迁移，必要时请重新跑分类。
- **重命名/合并**:
  - 在 `seed_prompt` 中替换旧名为新名，或把两个类别合并为一个，并合并其二级示例；
  - 为避免分散，尽量统一近义词用法。
- **注意事项**:
  - 分类阶段输出的是 JSON，键名即“一级标签”，与统计程序 `analyze.py` 解耦，无需同步修改统计逻辑；
  - 统计阶段会忽略“其他/其它/other/others”等一级标签；
  - 修改后建议先用小样本验证分类效果，再对全量数据运行。

